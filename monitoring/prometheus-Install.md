# ЁЯМР Prometheus Install

**Prometheus** рж╣рж▓рзЛ ржПржХржЯрж┐ **ржУржкрзЗржи-рж╕рзЛрж░рзНрж╕ ржоржирж┐ржЯрж░рж┐ржВ ржПржмржВ ржЕрзНржпрж╛рж▓рж╛рж░рзНржЯрж┐ржВ ржЯрзБрж▓ржХрж┐ржЯ**, ржпрж╛ ржорзВрж▓ржд рж╕рж╛рж░рзНржнрж╛рж░, ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи, ржПржмржВ рж╕рж╛рж░рзНржнрж┐рж╕рзЗрж░ **ржорзЗржЯрзНрж░рж┐ржХ (metrics) рж╕ржВржЧрзНрж░рж╣, рж╕ржВрж░ржХрзНрж╖ржг ржПржмржВ ржмрж┐рж╢рзНрж▓рзЗрж╖ржг** ржХрж░рж╛рж░ ржЬржирзНржп ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣ржпрж╝ред

---

### ЁЯза Prometheus ржХрзА ржХрж╛ржЬ ржХрж░рзЗ

1. **ржорзЗржЯрзНрж░рж┐ржХ рж╕ржВржЧрзНрж░рж╣ (Metrics Collection):**

   * ржПржЯрж┐ ржЖржкржирж╛рж░ рж╕рж╛рж░рзНржнрж╛рж░, ржЕрзНржпрж╛ржк, ржмрж╛ рж╕рж╛рж░рзНржнрж┐рж╕ ржерзЗржХрзЗ ржмрж┐ржнрж┐ржирзНржи ржбрзЗржЯрж╛ рж╕ржВржЧрзНрж░рж╣ ржХрж░рзЗред ржпрзЗржоржи: CPU ржмрзНржпржмрж╣рж╛рж░, ржорзЗржорзЛрж░рж┐, рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ рж╕ржВржЦрзНржпрж╛, рж▓рзНржпрж╛ржЯрзЗржирзНрж╕рж┐ ржЗрждрзНржпрж╛ржжрж┐ред
   * ржПржЯрж┐ рж╕рж╛ржзрж╛рж░ржгржд HTTP ржПрж░ ржорж╛ржзрзНржпржорзЗ `/metrics` endpoint ржерзЗржХрзЗ ржбрзЗржЯрж╛ ржкрзБрж▓ ржХрж░рзЗред

2. **ржбрзЗржЯрж╛ рж╕ржВрж░ржХрзНрж╖ржг (Data Storage):**

   * Prometheus ржирж┐ржЬрж╕рзНржм ржЯрж╛ржЗржо-рж╕рж┐рж░рж┐ржЬ ржбрж╛ржЯрж╛ржмрзЗрж╕рзЗ ржПржЗ ржбрзЗржЯрж╛ рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзЗред
   * ржЯрж╛ржЗржо-рж╕рж┐рж░рж┐ржЬ ржорж╛ржирзЗ, ржПржЯрж┐ ржбрзЗржЯрж╛ ржПржХрзНрж╕ржкрж┐рж░рж┐рзЯрзЗржирзНрж╕рзЗрж░ рж╕рж╛ржерзЗ рж╕рж╛ржерзЗ рж╕ржоржпрж╝ ржЕржирзБржпрж╛ржпрж╝рзА рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзЗред

3. **ржХрзЛржпрж╝рж╛рж░рзА ржХрж░рж╛ (Querying):**

   * Prometheus ржПрж░ ржирж┐ржЬрж╕рзНржм **PromQL** (Prometheus Query Language) ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЖржкржирж┐ ржбрзЗржЯрж╛ ржмрж┐рж╢рзНрж▓рзЗрж╖ржг ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред
   * ржпрзЗржоржи: тАЬржЧржд рзл ржорж┐ржирж┐ржЯрзЗ CPU ржмрзНржпржмрж╣рж╛рж░ ржХржд ржЫрж┐рж▓?тАЭ

4. **ржЕрзНржпрж╛рж▓рж╛рж░рзНржЯрж┐ржВ (Alerting):**

   * ржирж┐рж░рзНржжрж┐рж╖рзНржЯ рж╢рж░рзНржд ржкрзВрж░ржг рж╣рж▓рзЗ (ржпрзЗржоржи CPU рзпрзж% ржПрж░ ржмрзЗрж╢рж┐ рж╣рж▓рзЗ), ржПржЯрж┐ ржЕрзНржпрж╛рж▓рж╛рж░рзНржЯ рждрзИрж░рж┐ ржХрж░рждрзЗ ржкрж╛рж░рзЗ ржПржмржВ Slack, Email, PagerDuty ржПрж░ ржорждрзЛ рж╕рж┐рж╕рзНржЯрзЗржорзЗ ржкрж╛ржарж╛рждрзЗ ржкрж╛рж░рзЗред

### ЁЯЪи ржХрзЗржи ржжрж░ржХрж╛рж░

1. **рж╕рж┐рж╕рзНржЯрзЗржорзЗрж░ рж╕рзНржмрж╛рж╕рзНржерзНржпрзЗрж░ ржиржЬрж░ рж░рж╛ржЦрж╛рж░ ржЬржирзНржп:**

   * ржХрзЛржи рж╕рж╛рж░рзНржнрж╛рж░ ржмрж╛ рж╕рж╛рж░рзНржнрж┐рж╕рзЗ рж╕ржорж╕рзНржпрж╛ рж╣ржЪрзНржЫрзЗ ржХрж┐ржирж╛ рждрж╛ ржжрзНрж░рзБржд ржзрж░рждрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░рзЗред

2. **ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ ржЕржкржЯрж┐ржорж╛ржЗржЬрзЗрж╢ржирзЗрж░ ржЬржирзНржп:**

   * ржХрзЛржи ржХрзЛржб ржмрж╛ рж╕рж╛рж░рзНржнрж┐рж╕ ржзрзАрж░ рж╣ржЪрзНржЫрзЗ ржмрж╛ рж░рж┐рж╕рзЛрж░рзНрж╕ ржмрзЗрж╢рж┐ ржЦрж╛ржЪрзНржЫрзЗ рждрж╛ ржирж┐рж░рзНржзрж╛рж░ржг ржХрж░рждрзЗ ржкрж╛рж░рзЗред

3. **ржЕрзНржпрж╛ржирж╛рж▓рж╛ржЗржЯрж┐ржХрзНрж╕ ржПржмржВ рж░рж┐ржкрзЛрж░рзНржЯрж┐ржВ:**

   * рж▓рзЛржб, рж░рж┐ржХрзЛрзЯрзЗрж╕рзНржЯ ржЯрзНрж░рзЗржирзНржб, ржмрзНржпржмрж╣рж╛рж░ pattern ржмрзБржЭрждрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░рзЗред

4. **ржЕржЯрзЛ-рж╕рзНржХрзЗрж▓рж┐ржВ ржУ ржЕрзНржпрж╛рж▓рж╛рж░рзНржЯрзЗрж░ ржЬржирзНржп:**

   * Kubernetes ржмрж╛ ржХрзНрж▓рж╛ржЙржб рж╕рж╛рж░рзНржнрж┐рж╕рзЗ ржЕржЯрзЛ-рж╕рзНржХрзЗрж▓рж┐ржВ ржирж┐ржпрж╝ржорж┐ржд ржорзЗржЯрзНрж░рж┐ржХ ржжрзЗржЦрзЗ ржХрж░рждрзЗ ржкрж╛рж░рзЗред
   * ржпрзЗржХрзЛржирзЛ ржХрзНрж░рж┐ржЯрж┐ржХрж╛рж▓ рж╕ржорж╕рзНржпрж╛ рж╣рж▓рзЗ ржжрзНрж░рзБржд ржЕрзНржпрж╛рж▓рж╛рж░рзНржЯ ржкрж╛ржарж╛рждрзЗ ржкрж╛рж░рзЗред

ЁЯТб **рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржкрзЗ:**
Prometheus рж╣рж▓ ржЖржкржирж╛рж░ рж╕рж╛рж░рзНржнрж╛рж░ ржУ ржЕрзНржпрж╛ржкрзЗрж░ тАЬржбрж╛ржпрж╝рж╛ржЧржирж┐рж╕рзНржЯрж┐ржХ ржЪрзЛржЦтАЭ тАФ ржпрж╛ рж╕ржмрж╕ржоржпрж╝ ржжрзЗржЦржЫрзЗ ржХрзА ржЪрж▓ржЫрзЗ, ржХрж┐ржнрж╛ржмрзЗ ржЪрж▓ржЫрзЗ, ржПржмржВ рж╕ржорж╕рзНржпрж╛ рж╣рж▓рзЗ ржЖржкржирж╛ржХрзЗ ржЬрж╛ржирж╛ржЪрзНржЫрзЗред

### ЁЯЪи Prometheus User Create
```bash
  sudo useradd --no-create-home --shell /bin/false prometheus
```

### ЁЯЪи Directory Create
```bash
  sudo mkdir /etc/prometheus
  sudo mkdir /var/lib/prometheus

  # Add Permission

  sudo chown prometheus:prometheus /etc/prometheus
  sudo chown prometheus:prometheus /var/lib/prometheus
```

### ЁЯЪи Prometheus Download
```bash
  cd /tmp
  wget https://github.com/prometheus/prometheus/releases/download/v2.49.1/prometheus-2.49.1.linux-amd64.tar.gz

  tar xvf prometheus-2.49.1.linux-amd64.tar.gz
  cd prometheus-2.49.1.linux-amd64

  sudo cp prometheus /usr/local/bin/
  sudo cp promtool /usr/local/bin/

  sudo cp -r consoles /etc/prometheus
  sudo cp -r console_libraries /etc/prometheus
  sudo cp prometheus.yml /etc/prometheus/

  sudo chown -R prometheus:prometheus /etc/prometheus
```

### ЁЯЪи Basic Config
`prometheus.yml`
```yml
  vim /etc/prometheus/prometheus.yml

  global:
    scrape_interval: 15s

  scrape_configs:
    - job_name: "prometheus"
      static_configs:
        - targets: ["localhost:9090"]
```

### ЁЯЪи Systemd Service

```service
  sudo vim /etc/systemd/system/prometheus.service

  [Unit]
  Description=Prometheus Monitoring
  Wants=network-online.target
  After=network-online.target
  
  [Service]
  User=prometheus
  Group=prometheus
  Type=simple
  ExecStart=/usr/local/bin/prometheus \
    --config.file=/etc/prometheus/prometheus.yml \
    --storage.tsdb.path=/var/lib/prometheus
  
  [Install]
  WantedBy=multi-user.target
```
### ЁЯЪи Prometheus Start
```sh
  sudo systemctl daemon-reload
  sudo systemctl start prometheus
  sudo systemctl enable prometheus
  sudo systemctl status prometheus

  http://SERVER_IP:9090
  http://localhost:9090
```

